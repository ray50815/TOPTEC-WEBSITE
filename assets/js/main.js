const translations = {
  'zh-Hant': {
    nav: {
      brand: 'TOPTEC GLOBAL',
      home: '首頁',
      about: '關於我們',
      services: '服務項目',
      solutions: '方案計畫',
      cases: '案例研究',
      contactMenu: '聯絡我們',
      contactCta: '預約 DFM 檢視'
    },
    home: {
      hero: {
        eyebrow: '精密機構與外殼工程',
        title: '為新世代電子產品打造精密底殼與外殼。',
        subtitle:
          'Toptec Global 與您的團隊共同規劃治具、表面處理與品質控管，協助產品從 EVT 到量產都能達成外觀、結構與可靠度目標。',
        primaryCta: '查看外殼方案',
        secondaryCta: '與製造顧問洽談',
        stat1Value: '20+',
        stat1Label: '每年完成超過 20 件 NPI 與改版專案的 DFM 與公差檢討',
        stat2Value: '500+',
        stat2Label: '500+ 次量產批次以 SPC / CPK 追蹤',
        stat3Value: '72h',
        stat3Label: 'EVT 階段 DFM 平均回覆時間 72 小時',
        stat4Value: 'ISO',
        stat4Label: 'ISO 9001 / ISO 13485 品質體系與 RoHS 文件'
      },
      advantages: {
        title: '為何裝置團隊選擇 Toptec Global 打造外殼',
        subtitle: '我們將工業設計意圖轉化為可量產的外殼，在 EVT、DVT、PVT 各階段維持外觀標準與裝配可靠度。',
        card1Title: 'DFM 與公差堆疊控管',
        card1Text: '前期完成治具檢討、GD&T 與材料堆疊分析，避免變形、漏光與裝配問題。',
        card2Title: '材料與表面處理實驗室',
        card2Text: 'Class-A 陽極/烤漆產線、色彩比對、SPC/CPK 追蹤，並為每批次提供實驗室驗證。',
        card3Title: '證據導向品質與 PPAP',
        card3Text: '控制計畫、FAI/PPAP 文件與可靠度驗證，以透明的數位報告共享。',
        card4Title: '風險治理與供應持續',
        card4Text: '多工廠治具、緩衝庫存與保險支援的交付管理，守護量產爬坡。'
      },
      trust: {
        title: '客戶信任的品質體系與認證',
        subtitle: '通過 ISO 稽核的系統、PPAP 證據與符合管制品類的合規文件。',
        badge1: 'ISO 9001 與 ISO 13485 稽核通過的品質體系',
        badge2: 'PPAP、FAI 與控制計畫文件',
        badge3: 'RoHS、REACH 與材料追溯報告',
        badge4: 'Class-A 陽極與烤漆實驗室，符合外觀標準'
      },
      services: {
        title: '讓外殼就緒出貨的製造服務',
        subtitle: '整合 DFM、表面處理與供應支援，讓工業設計目標與可重複的量產品質一致。',
        card1Title: '量產化設計與治具開發',
        card1Text: '從 EVT 到 MP 的 DFM 檢討、公差堆疊分析、模具/治具設計驗證與可靠度治具，全部依您的 Build 計畫配置。',
        card1Cta: '申請 DFM 檢討',
        card2Title: '材料與表面處理',
        card2Text: '鋁、鎂外殼的陽極、烤漆、PVD、紋理控制與加速可靠度測試。',
        card2Cta: '預約表面處理諮詢',
        card3Title: '供應鏈與 JIT 配送',
        card3Text: '安全庫存與保稅倉、多據點治具、風險規劃與 VMI 計畫，確保產能爬坡無虞。',
        card3Cta: '安排供應規劃洽談'
      },
      testimonial: {
        quote1: 'Toptec 在 PVT 前就以治具調整配合 ID 設計意圖，試產的外觀問題因此消失。',
        cite1: '硬體營運副總裁，移動裝置 OEM',
        quote2: '他們的表面處理實驗室精準對出品牌色，提供 PPAP 證據，並提前兩週通過稽核。',
        cite2: '品質總監，智慧家庭平台'
      },
      cta: {
        title: '準備出貨完美外觀的外殼了嗎？',
        subtitle: '與製造團隊合作，為下一次 Build 規劃 DFM 行動、表面管控與供應緩衝。',
        button: '開始 Build 檢視'
      }
    },
    about: {
      hero: {
        eyebrow: '合規領導力',
        title: '以負責任治理守護關鍵大宗商品。',
        subtitle:
          'Toptec Global 立足新加坡，統籌石油與礦產供應計畫，滿足監管機關、稽核單位與下游客戶的要求。',
        cta: '與管理團隊洽談'
      },
      story: {
        title: '為公共領域透明供應而生',
        subtitle: '跨領域團隊結合採購法規、品質保證與營運韌性，專注關鍵物資供應。',
        point1:
          '<strong>石油治理桌。</strong> 持牌交易團隊管理原油、柴油與航煤調配，提供排放分析與法規報告，服務國營公用事業。',
        point2:
          '<strong>工業礦產桌。</strong> 供應石英砂與特殊骨材，具地質溯源、CSR 承諾與環境復育監管。',
        point3:
          '<strong>合規與財務辦公室。</strong> 將 AML/KYC、制裁審查、HSSE 監管與結構化融資融入流程，保護公帑。'
      },
      timeline: {
        title: '合規與成長里程碑',
        2006: '於新加坡成立，為國家公用事業提供合規的石油供應，並具備海關與 HSSE 全程監理。',
        2012: '建立區域合規樞紐與數位制裁篩檢，並拓展至中東與西非的上游合作。',
        2018: '成立工業礦產桌，提供地質溯源與環境監管計畫，支持公共基建。',
        2023: '推出監管報告入口與 ESG 儀表板，讓利害關係人即時掌握航次與排放。'
      },
      values: {
        title: '每次合作遵循的原則',
        subtitle: '合規、透明與責任治理是我們與公私部門合作的基石。',
        card1Title: '法規問責',
        card1Text: '從制裁、KYC/AML、反貪到電子採購義務，提供端到端治理與完整稽核軌跡。',
        card2Title: '營運保證',
        card2Text: '專業團隊監督抽樣、HSSE、航次執行與文件，並以即時儀表板服務監管機關與業者。',
        card3Title: '共享成長',
        card3Text: '與投入環境復育、在地就業與透明 ESG 報告的供應商合作。'
      },
      team: {
        title: '對監管與業者負責的領導團隊',
        subtitle: '資深主管結合治理、風險與物流專長，守護公共任務。',
        point1:
          '<strong>Adrian Lim，創辦人兼 CEO。</strong> 主導跨境燃料安全計畫逾十年，國家公用事業零稽核缺失。',
        point2:
          '<strong>Janice Wong，COO。</strong> 設計符合港務與環保監管要求的 HSSE 治理與多式聯運物流。',
        point3:
          '<strong>Kenji Sato，風險長。</strong> 建立與公共財務管控及國庫要求一致的避險、保險與融資架構。'
      },
      certifications: {
        title: '認證與會員資格',
        subtitle: '第三方認證驗證我們的合規、HSSE 與治理體系。',
        badge1: 'Enterprise Singapore 核發的合格商品交易商',
        badge2: 'ISO 9001、14001、45001 整合管理系統',
        badge3: 'TRACE 反賄賂認證夥伴',
        badge4: '會員：國際石油工業環境保護協會',
        badge5: '新加坡海事及港務局認可的 HSSE 與加油合規計畫'
      }
    },
    services: {
      hero: {
        eyebrow: '以合規為核心的服務',
        title: '為監管需求打造的整合商品供應方案。',
        subtitle:
          '交易團隊協調採購、品質保證與報告，協助公部門與下游營運者維持合規、不中斷的供應。',
        ctaPrimary: '查看合規流程',
        ctaSecondary: '預約合規諮詢'
      },
      commodities: {
        petroleumTitle: '石油治理桌',
        petroleumText: '規劃原油、柴油、航煤與燃油的結構化方案，於提名、檢驗與 HSSE 控制全程留存稽核軌跡。',
        petroleumPoint1: 'API、硫含量與排放檢測依法規完成並於裝船前核准',
        petroleumPoint2: 'APAC、MENA 與西非碼頭的裝船經制裁審查並核准',
        petroleumPoint3: '租船、保險與滯期管理皆在共享平台留存紀錄',
        mineralTitle: '工業礦產監管',
        mineralText: '提供高純度石英砂與特殊骨材，附地源追蹤、社區溝通與環境報告。',
        mineralPoint1: '每批附實驗室認證的粒徑、Fe2O3 與含水結果',
        mineralPoint2: '堆場與備貨計畫符合復育與生物多樣性承諾',
        mineralPoint3: '整合駁船、鐵路與末端物流，並具 HSSE 監督'
      },
      petroleum: {
        title: '石油供應能力',
        subtitle: '涵蓋原油、凝析油與成品油的合規能力，支援國家供應安全計畫。',
        card1Title: '原油與凝析油',
        card1Text: '提供酸甜原油，附排放分析、調和控管及政府核准的出口許可。',
        card2Title: '成品油',
        card2Text: '汽油、柴油、航煤與低硫燃油，附 ASTM/EN 檢測證明與碳排報告。',
        card3Title: '檢驗與認證',
        card3Text: '第三方檢驗管理採樣與保管鏈，出具數位品質與數量證書。',
        card4Title: '風險管理',
        card4Text: '避險、運費衍生品、保險與庫存融資，符合公共財政規範。'
      },
      minerals: {
        title: '工業礦產專長',
        subtitle: '與政府許可的礦山合作，提供可追溯的產出，用於關鍵基建與產業。',
        point1:
          '<strong>玻璃與太陽能製程。</strong> 提供超高透明度石英砂，附產地證明、監管簡報與可直接投產的品質控管。',
        point2:
          '<strong>能源與鑄造。</strong> 高性能壓裂砂，採礦符合 HSSE，並具即時庫存監測。',
        point3:
          '<strong>環境與永續。</strong> 復育計畫、生物多樣性抵換與 ESG 報告，符合公共揭露框架。',
        assuranceTitle: '實驗室保證',
        assurancePoint1: 'ISO/IEC 17025 認證實驗室，管理封簽的保管鏈採樣',
        assurancePoint2: '出貨核准前完成含水、泥量與重金屬分析',
        assurancePoint3: '數位放行證同時提供監管單位與客戶'
      },
      compliance: {
        title: '合規與治理',
        subtitle: '提供海關、稅務、環保與稽核單位全面透明的治理框架。',
        card1Title: '法規申報',
        card1Text: '自動化海關、稅務與環境申報，並提供監管單位共享的儀表板。',
        card2Title: '制裁與 KYC',
        card2Text: '持續的交易對手篩檢、船舶追蹤與稽核記錄，符合 OFAC、EU 與 UN 規範。',
        card3Title: 'HSSE 監督',
        card3Text: 'HSSE 演練、事件通報與第三方稽核，並邀請監管參與、全程留存紀錄。'
      },
      process: {
        title: '交易執行流程',
        step1: '對齊任務：確認政策指令、品質規格與利害關係人報告節奏。',
        step2: '採購與盡調：包含供應商稽核、ESG 評等、制裁合規與交易風險。',
        step3: '合約與檢驗規劃：安排實驗室時程、文件流程與監管存取控管。',
        step4: '航次執行：24/7 控制塔、HSSE 監督並對利害關係人推送里程碑。',
        step5: '交付後核對：提供合規證據、績效指標與持續改善路線圖。'
      },
      cta: {
        title: '需要合規導向的原料合作夥伴嗎？',
        subtitle: '告訴我們政策要求，我們會在一個工作天內整合可稽核的供應方案。',
        button: '聯繫合規團隊'
      }
    },
    solutions: {
      hero: {
        eyebrow: '符合政府要求的供應方案',
        title: '為石油與礦產量身打造、具透明治理的供應方案。',
        subtitle:
          '我們為國家煉油廠、公共基建與產業園區設計方案，並備妥可供監管審閱的文件。',
        ctaPrimary: '瀏覽監管情境手冊',
        ctaSecondary: '聯繫合規團隊'
      },
      programs: {
        title: '為各種任務打造的結構化方案',
        subtitle: '從緊急保證到十年期託管，每個方案都以合規、透明與財務責任為設計核心。',
        card1Title: '策略型提貨協議',
        card1Text: '多年期合約，提供油品等級彈性、可稽核的定價模型與監管核准的文件包。',
        card2Title: '即期最佳化',
        card2Text: '停機或需求暴增時迅速採購，動用預先審核的交易對手、緊急檢驗團隊與即時控制塔更新。',
        card3Title: '公共部門合作',
        card3Text: '以合規為導向的採購框架，對齊國家政策、預算週期、氣候目標與稽核流程。'
      },
      industries: {
        title: '產業情境手冊',
        subtitle: '選擇最接近您任務的情境，了解我們如何結合執行、合規證據與利害關係人報告。',
        empty: '沒有符合此篩選的方案，歡迎聯絡我們客製計畫。',
        card1Title: '原油原料合規方案',
        card1Pain: '痛點：原油檢測波動影響排放上限與產品規格。',
        card1Solution: '解方：雙油種配置、監管在場的 ISO/IEC 17025 實驗室，以及排放報告儀表板。',
        card1Result: '成果：維持 98% 產能利用、無硫含量違規通知，順利續約供應執照。',
        card2Title: '玻璃與太陽能用石英保障方案',
        card2Pain: '痛點：石英純度不穩定，導致議會審查延宕。',
        card2Solution: '解方：提供 Fe2O3 低於 110 ppm 的高純度石英，含水率受控儲存，並有共享 QA 平台。',
        card2Result: '成果：以創紀錄速度獲得擴產核准，產能提升無額外停機。',
        card3Title: '公用事業燃料安全與合規',
        card3Pain: '痛點：季節性需求與儲量限制，引來能源監管更嚴審查。',
        card3Solution: '解方：透過避險的燃油與柴油供應、浮動儲存、緊急調度手冊與監管簡報工具。',
        card3Result: '成果：維持 45 天前置庫存，透明報告獲國家能源監管接受。',
        card4Title: '公共基建骨材治理',
        card4Pain: '痛點：採購稽核延宕骨材核准，影響戰略基建。',
        card4Solution: '解方：符合法規的招標採購、ESG 報告，以及附照片佐證的里程碑交付。',
        card4Result: '成果：在稽核時限內獲批，交付 180 萬噸且無差異罰則。'
      },
      filters: {
        all: '全部方案',
        refinery: '煉油廠',
        glass: '玻璃與太陽能',
        infra: '公共基礎建設',
        energy: '能源與公用事業'
      },
      assurance: {
        title: '治理與透明度',
        point1: '季度合規簡報、共享資料室與監管可用的文件',
        point2: '整合政府監察名單的制裁、KYC 與船舶追蹤程序',
        point3: '涵蓋排放、水資源、土地復育與社區影響的永續指標'
      },
      support: {
        title: '支援服務',
        point1: '報關、保稅倉儲與國內配送，附合規報告',
        point2: '貿易融資、庫存融資與結構化付款，符合公共採購規範',
        point3: '市場情報、政策監測與利害關係人溝通手冊'
      },
      cta: {
        title: '與合規導向的商品團隊合作',
        subtitle:
          '告訴我們燃料安全或礦產供應目標，我們會設計透明方案並提供利害關係人所需的合規證據。',
        button: '啟動合規方案'
      }
    },
    cases: {
      hero: {
        eyebrow: '合規實例',
        title: '我們如何以監管等級的透明度讓關鍵物資持續運行。',
        subtitle:
          '每個案例皆展示我們如何協調部會、稽核與營運方，維持合規且不中斷的供應。'
      },
      card1Title: '國家公用事業緊急柴油合規方案',
      card1Text:
        '東南亞某電力主管機關在嚴格監管下需要緊急柴油交付。我們啟動預先審核的供應商、佈署浮動儲槽，並於 72 小時內完成通關協調。',
      card1Point1: '12 次緊急航次皆有監管見證的品管與報告',
      card1Point2: '緊急稽核零缺失，並完成全部成本追回',
      card1Point3: '租賃資產零滯期費與 HSSE 事故',
      card2Title: '主權基金支持的玻璃擴產石英合規供應',
      card2Text:
        '某主權基金支持的浮法玻璃廠需超低鐵石英砂，並需完全透明以供議會審查。我們驗證來源、設置現場含水控制，並讓駁船交付與爐線試產計畫同步。',
      card2Point1: 'ISO/IEC 17025 實驗室驗證的 99.7% SiO2、Fe2O3 低於 110 ppm',
      card2Point2: '專責合規官每日向政府專案辦公室回報',
      card2Point3: '試車期間爐線零停機，且提供完整合規報告',
      card3Title: '公共運輸燃料安全與合規',
      card3Text:
        '某都會運輸機構需確保柴油供應，同時滿足交通部監理。我們導入避險、保稅倉儲與供監管使用的合規平台。',
      card3Point1: '維持 45 天庫存並留存備油測試紀錄',
      card3Point2: '透過協同避險與透明報告，價格波動降低 28%',
      card3Point3: '合規平台獲財政部與交通主管機關採用',
      cta: {
        title: '準備向利害關係人簡報供應合規了嗎？',
        subtitle: '我們與監管、稽核與營運方合作，制定可量測的合規交付計畫。',
        button: '索取合規簡報'
      }
    },
    contact: {
      hero: {
        eyebrow: '安排合規簡報',
        title: '與 Toptec Global 合規聯絡團隊對話',
        subtitle:
          '分享您的採購任務、合規要求或技術文件，我們的專家將於一個工作天內回覆。'
      },
      form: {
        title: '告訴我們您的需求',
        subtitle:
          '請填寫法規義務、品質規格與時程。如果偏好 Email 或電話，也可使用右側資訊聯繫合規團隊。',
        assurance: '提交合規文件或 BOM，我們會在 24 小時內回覆可供稽核的行動計畫（週一至週五，GMT+8）。',
        nameLabel: '姓名',
        namePlaceholder: '請輸入姓名',
        companyLabel: '公司',
        companyPlaceholder: '公司名稱',
        titleLabel: '職稱',
        titlePlaceholder: '例如：採購經理',
        emailLabel: '公司 Email',
        emailPlaceholder: 'name@company.com',
        phoneLabel: '電話（選填）',
        phonePlaceholder: '國碼 + 號碼',
        messageLabel: '我們可以如何支援？',
        messagePlaceholder: '請說明需求',
        privacyLabel: '我同意 <a href="privacy.html">隱私權政策</a>。',
        successMessage: '感謝您的聯絡，我們會在一個工作天內回覆。',
        submit: '送出合規詢問'
      },
      details: {
        title: '直接聯絡方式',
        text: '合規協調人員服務時間為週一至週五 09:00-18:00（GMT+8）。',
        phoneLabel: '電話：',
        phoneValue: '+65 6970 3201',
        emailLabel: 'Email：',
        emailValue: 'hello@toptecglobal.com',
        addressLabel: '地址：',
        addressValue: '8 Marina View, #35-02 Asia Square Tower 1, Singapore 018960',
        response: '我們會在一個工作天內回覆下一步與所需文件。'
      },
      map: {
        title: '歡迎造訪總部'
      },
      resources: {
        title: '需要立即的合規協助？',
        text: '可查看合規工具包或開啟即時聊天，取得緊急文件與物流更新。',
        cta: '查看合規手冊'
      },
      cta: {
        title: '我們隨時提供供應合規證據',
        subtitle: '無論是緊急保障或長期方案，傳訊即可聯繫合規團隊。',
        button: '撥打合規專線',
        commit: '提交政策要求或 BOM，我們會在 24 小時內回覆（週一至週五，GMT+8）。'
      }
    },
    footer: {
      brand: 'TOPTEC GLOBAL',
      tagline: '為移動、醫療與智慧裝置團隊提供精密底殼與外殼製造。',
      linksTitle: '公司',
      about: '關於我們',
      services: '服務項目',
      solutions: '方案計畫',
      cases: '案例研究',
      contact: '聯絡我們',
      resourcesTitle: '資源',
      resource1: '石油品質計畫',
      resource2: '永續與 HSSE 承諾',
      resource3: '認證與會員資格',
      resource4: '市場情報',
      copy: '&copy; 2024 TOPTEC GLOBAL PTE. LTD. 版權所有。',
      uen: 'UEN: 201912345K | 新加坡 ACRA 註冊',
      privacy: '隱私權政策',
      terms: '使用條款'
    },
    general: {
      form: {
        required: '此欄位為必填。',
        email: '請輸入有效的 Email。',
        businessEmail: '請使用公司 Email。',
        privacy: '請同意隱私權政策後再送出。',
        submitting: '送出中...',
        success: '訊息已送出，我們將盡快回覆。'
      }
    }
  }
};
document.addEventListener('DOMContentLoaded', () => {
  const body = document.body;
  const nav = document.querySelector('nav.primary-nav');
  const toggle = document.querySelector('.mobile-toggle');
  const langButtons = document.querySelectorAll('.language-switcher button[data-lang]');
  const langToggle = document.querySelector('.language-switcher button[data-lang-toggle]');
  const htmlElement = document.documentElement;
  const currentPage = body.dataset.page;

  let formMessages = {};
  function updateFormMessages(lang) {
    const target = lang || body.dataset.lang || 'en';
    formMessages = {
      required: getTranslation(target, 'general.form.required') || 'Please fill out this field.',
      email: getTranslation(target, 'general.form.email') || 'Please enter a valid email address.',
      businessEmail: getTranslation(target, 'general.form.businessEmail') || 'Please use your business email address.',
      privacy: getTranslation(target, 'general.form.privacy') || 'Please agree to the Privacy Policy before submitting.',
      submitting: getTranslation(target, 'general.form.submitting') || 'Submitting...',
      success: getTranslation(target, 'general.form.success') || 'Your message has been sent. We will respond shortly.'
    };
  }

  updateFormMessages(body.dataset.lang || 'en');

  const navLinks = nav ? nav.querySelectorAll('a[data-page]') : [];
  navLinks.forEach((link) => {
    if (link.dataset.page === currentPage) {
      link.classList.add('active');
    }
  });

  if (toggle && nav) {
    const closeMenu = () => {
      nav.classList.remove('open');
      toggle.setAttribute('aria-expanded', 'false');
      body.classList.remove('menu-open');
    };

    toggle.addEventListener('click', () => {
      const expanded = toggle.getAttribute('aria-expanded') === 'true';
      const nextState = !expanded;
      toggle.setAttribute('aria-expanded', String(nextState));
      nav.classList.toggle('open', nextState);
      body.classList.toggle('menu-open', nextState);
    });

    navLinks.forEach((link) => {
      link.addEventListener('click', () => {
        closeMenu();
      });
    });

    const desktopQuery = window.matchMedia('(min-width: 1025px)');
    const handleDesktopChange = (event) => {
      if (event.matches) {
        closeMenu();
      }
    };
    if (desktopQuery.addEventListener) {
      desktopQuery.addEventListener('change', handleDesktopChange);
    } else {
      desktopQuery.addListener(handleDesktopChange);
    }

    document.addEventListener('keyup', (event) => {
      if (event.key === 'Escape') {
        closeMenu();
      }
    });
  }

  let i18nElements = [];
  let placeholderElements = [];

  const registerI18nElements = (root = document) => {
    const elements = Array.from(root.querySelectorAll('[data-i18n]'));
    if (!elements.length) {
      return;
    }
    elements.forEach((el) => {
      if (!el.dataset.i18nEn) {
        el.dataset.i18nEn = el.innerHTML.trim();
      }
    });
    i18nElements = Array.from(new Set([...i18nElements, ...elements]));
  };

  const registerPlaceholderElements = (root = document) => {
    const elements = Array.from(root.querySelectorAll('[data-i18n-placeholder]'));
    if (!elements.length) {
      return;
    }
    elements.forEach((el) => {
      if (!el.dataset.i18nPlaceholderEn) {
        el.dataset.i18nPlaceholderEn = el.getAttribute('placeholder') || '';
      }
    });
    placeholderElements = Array.from(new Set([...placeholderElements, ...elements]));
  };

  registerI18nElements(document);
  registerPlaceholderElements(document);

  const applyLazyLoading = () => {
    const candidates = document.querySelectorAll('img:not([loading])');
    candidates.forEach((img) => {
      const inHeader = img.closest('.site-header');
      const inHero = img.closest('.hero');
      if (img.getAttribute('fetchpriority') === 'high' || inHeader || inHero) {
        return;
      }
      img.loading = 'lazy';
      if (!img.getAttribute('decoding')) {
        img.decoding = 'async';
      }
    });
  };

  function getTranslation(lang, key) {
    const parts = key.split('.');
    let value = translations[lang];
    for (const part of parts) {
      if (!value) {
        return undefined;
      }
      value = value[part];
    }
    return typeof value === 'string' ? value : undefined;
  }

  const updateLangToggle = (activeLang) => {
    if (!langToggle) return;
    const nextLang = activeLang === 'zh-Hant' ? 'en' : 'zh-Hant';
    langToggle.textContent = nextLang === 'zh-Hant' ? '繁中' : 'EN';
    langToggle.setAttribute('aria-label', nextLang === 'zh-Hant' ? '切換為繁體中文' : 'Switch to English');
    langToggle.dataset.targetLang = nextLang;
    langToggle.setAttribute('aria-pressed', activeLang === 'zh-Hant' ? 'true' : 'false');
  };

  function setLanguage(lang) {
    const targetLang = lang === 'zh-Hant' ? 'zh-Hant' : 'en';
    htmlElement.setAttribute('lang', targetLang === 'zh-Hant' ? 'zh-Hant' : 'en');
    body.dataset.lang = targetLang;

    updateFormMessages(targetLang);
    updateLangToggle(targetLang);

    langButtons.forEach((btn) => {
      btn.classList.toggle('active', btn.dataset.lang === targetLang);
      btn.setAttribute('aria-pressed', btn.dataset.lang === targetLang ? 'true' : 'false');
    });

    i18nElements.forEach((el) => {
      const key = el.dataset.i18n;
      if (!key) return;
      if (targetLang === 'en') {
        el.innerHTML = el.dataset.i18nEn || el.innerHTML;
      } else {
        const translated = getTranslation(targetLang, key);
        el.innerHTML = translated || el.dataset.i18nEn || el.innerHTML;
      }
    });

    placeholderElements.forEach((el) => {
      const key = el.dataset.i18nPlaceholder;
      if (!key) return;
      if (targetLang === 'en') {
        el.setAttribute('placeholder', el.dataset.i18nPlaceholderEn || '');
      } else {
        const translated = getTranslation(targetLang, key);
        el.setAttribute('placeholder', translated || el.dataset.i18nPlaceholderEn || '');
      }
    });

    initCountUp({ reset: true });
    localStorage.setItem('toptec-lang', targetLang);
  }

  const savedLang = localStorage.getItem('toptec-lang') || 'en';
  setLanguage(savedLang);
  applyLazyLoading();

  if (langToggle) {
    langToggle.addEventListener('click', () => {
      const next = langToggle.dataset.targetLang || (body.dataset.lang === 'zh-Hant' ? 'en' : 'zh-Hant');
      setLanguage(next);
    });
  }

  langButtons.forEach((btn) => {
    btn.addEventListener('click', () => {
      const lang = btn.dataset.lang || 'en';
      setLanguage(lang);
    });
  });

  initIndustryFilters();

  const faqItems = document.querySelectorAll('.faq-item');
  faqItems.forEach((item) => {
    item.setAttribute('role', 'button');
    const answers = Array.from(item.querySelectorAll('p'));
    const indicator = item.querySelector("h4 span[aria-hidden=\"true\"]");

    const applyState = (isOpen) => {
      item.classList.toggle('open', isOpen);
      item.setAttribute('aria-expanded', String(isOpen));
      if (indicator) {
        indicator.textContent = isOpen ? '-' : '+';
      }
      answers.forEach((answer) => {
        answer.style.display = isOpen ? 'block' : 'none';
      });
    };

    applyState(false);

    item.addEventListener('click', () => {
      applyState(!item.classList.contains('open'));
    });

    item.addEventListener('keypress', (event) => {
      if (event.key === 'Enter' || event.key === ' ' || event.key === 'Spacebar') {
        event.preventDefault();
        applyState(!item.classList.contains('open'));
      }
    });
  });

  function showTestimonial(index) {
    testimonialSlides.forEach((slide, idx) => {
      slide.classList.toggle('active', idx === index);
    });
  }

  if (testimonialSlides.length > 0) {
    showTestimonial(testimonialIndex);

    prevBtn?.addEventListener('click', () => {
      testimonialIndex = (testimonialIndex - 1 + testimonialSlides.length) % testimonialSlides.length;
      showTestimonial(testimonialIndex);
    });

    nextBtn?.addEventListener('click', () => {
      testimonialIndex = (testimonialIndex + 1) % testimonialSlides.length;
      showTestimonial(testimonialIndex);
    });

    setInterval(() => {
      testimonialIndex = (testimonialIndex + 1) % testimonialSlides.length;
      showTestimonial(testimonialIndex);
    }, 8000);
  }

  const contactForm = document.querySelector('#contact-form');
  if (contactForm) {
    const formFields = contactForm.querySelectorAll('input[required], textarea[required]');
    const submitButton = contactForm.querySelector("button[type='submit']");
    const emailField = contactForm.querySelector('#email');
    const privacyCheckbox = contactForm.querySelector('#agree-privacy');
    const freeEmailDomains = ['gmail.com', 'yahoo.com', 'hotmail.com', 'outlook.com', 'icloud.com', 'aol.com', 'qq.com', '163.com', '126.com', 'protonmail.com', 'hey.com', 'msn.com', 'live.com', 'me.com', 'gmx.com'];

    const isFreeDomain = (address) => {
      const atIndex = address.indexOf('@');
      if (atIndex === -1) return false;
      const domain = address.slice(atIndex + 1).toLowerCase();
      return freeEmailDomains.some((freeDomain) => domain === freeDomain || domain.endsWith('.' + freeDomain));
    };

    const validateBusinessEmail = () => {
      if (!emailField) return;
      const value = emailField.value.trim().toLowerCase();
      if (value && isFreeDomain(value)) {
        emailField.setCustomValidity(formMessages.businessEmail);
      } else {
        emailField.setCustomValidity('');
      }
    };

    if (emailField) {
      emailField.addEventListener('input', validateBusinessEmail);
      emailField.addEventListener('blur', validateBusinessEmail);
    }

    if (privacyCheckbox) {
      privacyCheckbox.addEventListener('change', () => {
        privacyCheckbox.setCustomValidity('');
      });
    }

    formFields.forEach((field) => {
      field.addEventListener('input', () => {
        field.setCustomValidity('');
      });

      field.addEventListener('invalid', () => {
        if (field.validity.customError) return;
        let message = formMessages.required;
        if (field.type === 'email') {
          message = formMessages.email;
        } else if (privacyCheckbox && field === privacyCheckbox) {
          message = formMessages.privacy;
        }
        field.setCustomValidity(message);
      });
    });

    contactForm.addEventListener('submit', (event) => {
      validateBusinessEmail();
      if (privacyCheckbox) {
        if (!privacyCheckbox.checked) {
          privacyCheckbox.setCustomValidity(formMessages.privacy);
        } else {
          privacyCheckbox.setCustomValidity('');
        }
      }

      if (!contactForm.checkValidity()) {
        event.preventDefault();
        contactForm.reportValidity();
        return;
      }

      event.preventDefault();
      if (submitButton) {
        submitButton.dataset.originalLabel = submitButton.textContent;
        submitButton.disabled = true;
        submitButton.textContent = formMessages.submitting;
      }

      const successMessage = contactForm.querySelector('.success-message');
      contactForm.reset();
      formFields.forEach((field) => field.setCustomValidity(''));

      if (successMessage) {
        successMessage.textContent = formMessages.success;
        successMessage.classList.add('show');
        setTimeout(() => successMessage.classList.remove('show'), 6000);
      }

      if (submitButton) {
        const resetText = submitButton.dataset.originalLabel || submitButton.textContent;
        setTimeout(() => {
          submitButton.disabled = false;
          submitButton.textContent = resetText;
        }, 600);
      }
    });
  }
  initScrollAnimations();
  initCountUp();
  initHeroInteractions();

  function initHeroInteractions() {
    const hero = document.querySelector('.hero');
    if (!hero) {
      return;
    }

    const heroContainer = hero.querySelector('.container');
    if (!heroContainer) {
      return;
    }

    const heroMedia = hero.querySelector('.hero-media');
    const motionQuery = window.matchMedia('(prefers-reduced-motion: reduce)');
    let prefersReducedMotion = motionQuery.matches;

    const resetHeroState = () => {
      heroContainer.style.setProperty('--hero-tilt-x', '0deg');
      heroContainer.style.setProperty('--hero-tilt-y', '0deg');
      hero.style.setProperty('--hero-highlight-opacity', '0');
      hero.style.setProperty('--hero-highlight-x', '50%');
      hero.style.setProperty('--hero-highlight-y', '50%');
      if (heroMedia) {
        heroMedia.style.setProperty('--hero-parallax-x', '0px');
        heroMedia.style.setProperty('--hero-parallax-y', '0px');
      }
    };

    resetHeroState();

    hero.addEventListener('focusin', () => {
      hero.style.setProperty('--hero-highlight-opacity', '0.65');
    });

    hero.addEventListener('focusout', () => {
      resetHeroState();
    });

    let rafId;

    const applyHeroInteraction = (clientX, clientY) => {
      cancelAnimationFrame(rafId);
      rafId = window.requestAnimationFrame(() => {
        const rect = heroContainer.getBoundingClientRect();
        if (!rect.width || !rect.height) {
          return;
        }

        const relativeX = Math.min(Math.max((clientX - rect.left) / rect.width, 0), 1);
        const relativeY = Math.min(Math.max((clientY - rect.top) / rect.height, 0), 1);
        const tiltX = ((relativeY - 0.5) * -10).toFixed(2);
        const tiltY = ((relativeX - 0.5) * 10).toFixed(2);
        heroContainer.style.setProperty('--hero-tilt-x', `${tiltX}deg`);
        heroContainer.style.setProperty('--hero-tilt-y', `${tiltY}deg`);

        hero.style.setProperty('--hero-highlight-opacity', '0.9');
        hero.style.setProperty('--hero-highlight-x', `${(relativeX * 100).toFixed(2)}%`);
        hero.style.setProperty('--hero-highlight-y', `${(relativeY * 100).toFixed(2)}%`);

        if (heroMedia) {
          const parallaxX = ((relativeX - 0.5) * 26).toFixed(2);
          const parallaxY = ((relativeY - 0.5) * 26).toFixed(2);
          heroMedia.style.setProperty('--hero-parallax-x', `${parallaxX}px`);
          heroMedia.style.setProperty('--hero-parallax-y', `${parallaxY}px`);
        }
      });
    };

    const onPointerEnter = (event) => {
      applyHeroInteraction(event.clientX, event.clientY);
    };

    const onPointerMove = (event) => {
      applyHeroInteraction(event.clientX, event.clientY);
    };

    const onPointerLeave = () => {
      cancelAnimationFrame(rafId);
      resetHeroState();
    };

    const enablePointerEffects = () => {
      hero.addEventListener('pointerenter', onPointerEnter);
      hero.addEventListener('pointermove', onPointerMove);
      hero.addEventListener('pointerleave', onPointerLeave);
    };

    const disablePointerEffects = () => {
      hero.removeEventListener('pointerenter', onPointerEnter);
      hero.removeEventListener('pointermove', onPointerMove);
      hero.removeEventListener('pointerleave', onPointerLeave);
    };

    if (!prefersReducedMotion) {
      enablePointerEffects();
    }

    const handleMotionPreference = (event) => {
      prefersReducedMotion = event?.matches ?? motionQuery.matches;
      disablePointerEffects();
      resetHeroState();
      if (!prefersReducedMotion) {
        enablePointerEffects();
      }
    };

    if (motionQuery.addEventListener) {
      motionQuery.addEventListener('change', handleMotionPreference);
    } else {
      motionQuery.addListener(handleMotionPreference);
    }
  }
  function initIndustryFilters() {
    const filterGroup = document.querySelector('[data-industry-filter-group]');
    const cards = Array.from(document.querySelectorAll('[data-industry-grid] .industry-card'));
    if (!filterGroup || !cards.length) {
      return;
    }
    const buttons = Array.from(filterGroup.querySelectorAll('[data-industry-filter]'));
    if (!buttons.length) {
      return;
    }
    const emptyState = document.querySelector('[data-industry-empty]');
    const grid = document.querySelector('[data-industry-grid]');

    const applyFilter = (filter) => {
      const normalized = (filter && filter.trim()) || 'all';
      buttons.forEach((btn) => {
        const isActive = (btn.dataset.industryFilter || 'all') === normalized;
        btn.classList.toggle('is-active', isActive);
        btn.setAttribute('aria-pressed', String(isActive));
      });

      let visibleCount = 0;
      cards.forEach((card) => {
        const categories = (card.dataset.industry || '')
          .split(/\s+/)
          .map((item) => item.trim())
          .filter(Boolean);
        const shouldShow = normalized === 'all' || categories.includes(normalized);
        card.hidden = !shouldShow;
        if (shouldShow) {
          visibleCount += 1;
        }
      });

      if (emptyState) {
        emptyState.hidden = visibleCount > 0;
      }
      if (grid) {
        grid.dataset.activeFilter = normalized;
      }
    };

    buttons.forEach((button) => {
      button.addEventListener('click', () => {
        applyFilter(button.dataset.industryFilter || 'all');
      });
    });

    filterGroup.addEventListener('keydown', (event) => {
      if (!['ArrowLeft', 'ArrowRight', 'Home', 'End'].includes(event.key)) {
        return;
      }
      event.preventDefault();
      const currentIndex = buttons.indexOf(document.activeElement);
      let nextIndex = currentIndex;
      if (event.key === 'ArrowRight') {
        nextIndex = (currentIndex + 1) % buttons.length;
      } else if (event.key === 'ArrowLeft') {
        nextIndex = (currentIndex - 1 + buttons.length) % buttons.length;
      } else if (event.key === 'Home') {
        nextIndex = 0;
      } else if (event.key === 'End') {
        nextIndex = buttons.length - 1;
      }
      buttons[Math.max(0, nextIndex)]?.focus();
    });

    const defaultFilter =
      filterGroup.querySelector('.filter-chip.is-active')?.dataset.industryFilter || 'all';
    applyFilter(defaultFilter);
  }

  function initScrollAnimations() {
    const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    const animationGroups = [
      { selector: '.hero-content > *', stagger: 0.08 },
      { selector: '.hero-media', origin: 'right', startDelay: 0.3 },
      { selector: '.hero-stats .stat', startDelay: 0.25, stagger: 0.08 },
      { selector: '.section-title', startDelay: 0.1 },
      { selector: '.section-subtitle', startDelay: 0.15 },
      { selector: '.card-grid .card', stagger: 0.12 },
      { selector: '.split-grid > *', stagger: 0.12 },
      { selector: '.badge-list .badge', stagger: 0.05 },
      { selector: '.timeline .timeline-item', stagger: 0.1 },
      { selector: '.industry-filter .filter-chip', stagger: 0.06 },
      { selector: '.industry-grid .industry-card', stagger: 0.12 },
      { selector: '.case-carousel .case-card', stagger: 0.12 },
      { selector: '.highlight-box', startDelay: 0.2 },
      { selector: '.process-steps .step', stagger: 0.08 },
      { selector: '.contact-grid > *', stagger: 0.12 },
      { selector: '.contact-details li', stagger: 0.06 },
      { selector: '.list-check li', stagger: 0.05 },
      { selector: '.faq-item', origin: 'scale', stagger: 0.1 },
      { selector: '.legal-card', origin: 'scale', stagger: 0.12 },
      { selector: '.testimonial-slide', stagger: 0.12 },
      { selector: '.hero-cta .btn', stagger: 0.08 }
    ];

    const seen = new Set();
    const orderedElements = [];

    const registerElement = (element, options, index) => {
      if (!element) {
        return;
      }
      if (!seen.has(element)) {
        element.classList.add('animate-on-scroll');
        if (options.origin === 'left') {
          element.classList.add('animate-from-left');
        } else if (options.origin === 'right') {
          element.classList.add('animate-from-right');
        } else if (options.origin === 'scale') {
          element.classList.add('animate-scale');
        }
        seen.add(element);
        orderedElements.push(element);
      }

      if (!element.style.getPropertyValue('--animate-delay')) {
        let delay = options.startDelay || 0;
        if (typeof options.stagger === 'number') {
          delay += index * options.stagger;
        }
        if (delay > 0) {
          element.style.setProperty('--animate-delay', `${delay.toFixed(2)}s`);
        }
      }
    };

    animationGroups.forEach(({ selector, ...options }) => {
      document.querySelectorAll(selector).forEach((element, index) => {
        registerElement(element, options, index);
      });
    });

    if (!orderedElements.length) {
      return;
    }

    if (prefersReducedMotion) {
      orderedElements.forEach((element) => element.classList.add('is-visible'));
      return;
    }

    const intersectionObserver = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.classList.add('is-visible');
            intersectionObserver.unobserve(entry.target);
          }
        });
      },
      {
        threshold: 0.2,
        rootMargin: '0px 0px -10% 0px'
      }
    );

    const isElementInViewport = (element) => {
      const rect = element.getBoundingClientRect();
      const viewportHeight = window.innerHeight || document.documentElement.clientHeight;
      const viewportWidth = window.innerWidth || document.documentElement.clientWidth;

      if (rect.bottom <= 0 || rect.right <= 0 || rect.top >= viewportHeight || rect.left >= viewportWidth) {
        return false;
      }

      const triggerOffset = Math.min(rect.height || 0, viewportHeight) * 0.25;
      return rect.top <= viewportHeight - triggerOffset;
    };

    window.requestAnimationFrame(() => {
      body.classList.add('animations-enabled');
      orderedElements.forEach((element) => {
        if (isElementInViewport(element)) {
          element.classList.add('is-visible');
        } else {
          intersectionObserver.observe(element);
        }
      });
    });
  }
  function initCountUp(options = {}) {
    const { reset = false } = options;
    const counters = document.querySelectorAll('[data-count-up]');
    if (!counters.length) {
      return;
    }

    const easeOutQuad = (t) => 1 - (1 - t) * (1 - t);

    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (!entry.isIntersecting) {
            return;
          }
          const counter = entry.target;
          if (counter.dataset.countAnimated === 'true' && !reset) {
            observer.unobserve(counter);
            return;
          }
          animateCounter(counter);
          observer.unobserve(counter);
        });
      },
      { threshold: 0.6 }
    );

    counters.forEach((counter) => {
      if (!counter.dataset.countOriginal) {
        counter.dataset.countOriginal = counter.textContent.trim();
      }
      if (reset) {
        counter.textContent = counter.dataset.countOriginal;
        counter.dataset.countAnimated = '';
      }
      observer.observe(counter);
    });

    function animateCounter(counter) {
      if (counter.dataset.countAnimated === 'true') {
        return;
      }
      const { value, prefix, suffix, decimals, duration } = resolveCounterConfig(counter);
      if (value === null || Number.isNaN(value)) {
        counter.dataset.countAnimated = 'true';
        return;
      }
      const totalDuration = duration > 0 ? duration : 1400;
      const startTime = performance.now();

      const render = (now) => {
        const progress = Math.min((now - startTime) / totalDuration, 1);
        const eased = easeOutQuad(progress);
        const currentValue = value * eased;
        counter.textContent = `${prefix}${formatNumber(currentValue, decimals)}${suffix}`;
        if (progress < 1) {
          requestAnimationFrame(render);
        } else {
          counter.textContent = `${prefix}${formatNumber(value, decimals)}${suffix}`;
          counter.dataset.countAnimated = 'true';
        }
      };

      requestAnimationFrame(render);
    }

    function resolveCounterConfig(counter) {
      let prefix = counter.dataset.countPrefix ?? '';
      let suffix = counter.dataset.countSuffix ?? '';
      const decimals = Number(counter.dataset.countDecimals ?? '0');
      const duration = Number(counter.dataset.countDuration ?? '1400');
      let value = counter.dataset.countValue ?? counter.dataset.countFinal;
      value = value !== undefined ? Number(value) : null;

      if (value === null || Number.isNaN(value)) {
        const original = counter.dataset.countOriginal || counter.textContent;
        const match = original.trim().match(/^([^\d-]*)([-\d.,]+)(.*)$/);
        if (match) {
          if (!prefix) {
            prefix = match[1];
          }
          if (!suffix) {
            suffix = match[3];
          }
          value = Number(match[2].replace(/,/g, ''));
          counter.dataset.countPrefix = prefix;
          counter.dataset.countSuffix = suffix;
          counter.dataset.countValue = String(value);
        }
      }

      if (Number.isNaN(value)) {
        value = null;
      }

      return { value, prefix, suffix, decimals, duration };
    }

    function formatNumber(number, decimals) {
      if (decimals > 0) {
        return number.toFixed(decimals);
      }
      return Math.round(number).toLocaleString();
    }
  }
});










