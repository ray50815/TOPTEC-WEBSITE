const translations = {
  'zh-Hant': {
    nav: {
      brand: 'TOPTEC GLOBAL',
      home: '首頁',
      about: '關於我們',
      services: '產品與服務',
      solutions: '解決方案',
      cases: '成功案例',
      contactMenu: '聯絡我們',
      contactCta: '取得採購方案'
    },
    home: {
      hero: {
        eyebrow: '精密底蓋方案',
        title: '與您協作打造即可量產的底蓋',
        subtitle:
          '我們與您共同開發底蓋的模具、表面處理與包裝，從試產到全球上市都能完美交付。',
        primaryCta: '了解底蓋方案',
        secondaryCta: '瀏覽製造能力與服務',
        stat1Value: '20+',
        stat1Label: '年專注外殼製造',
        stat2Value: '500+',
        stat2Label: '種通過驗證的表面處理組合',
        stat3Value: '72h',
        stat3Label: 'DFM 建議回覆時間',
        stat4Value: 'ISO',
        stat4Label: '項國際認證品質體系'
      },
      advantages: {
        title: '品牌選擇我們底蓋計畫的理由',
        subtitle: '從材料選擇到產線即用包裝，每一件底蓋出廠即備妥最終組裝。',
        card1Title: '材料與模具專業',
        card1Text: '透過 DFM 工作坊、多腔模具設計與金屬／聚合物專長，確保每批量產都維持嚴密公差。',
        card2Title: '表面與外觀保證',
        card2Text: 'Class-A 表面處理實驗室提供一致的紋理、色彩與塗層，結合 SPC 監控達成零外觀缺陷批次。',
        card3Title: '整合式組裝物流',
        card3Text: '預先安裝嵌件、客製防護包材與區域緩衝庫存，讓下游產線持續運作。',
        card4Title: '夥伴式協作',
        card4Text: '專責工程師在產品生命週期內同步設計變更、認證文件與製程控管。'
      },
      trust: {
        title: '獲全球裝置創新者信任',
        subtitle: '是消費科技、行動載具、智慧居家與工業設備品牌首選的底蓋夥伴。',
        badge1: 'ISO 9001:2015',
        badge2: 'ISO 13485 就緒',
        badge3: '通過認證的表面處理實驗室',
        badge4: '新加坡製造業總會會員'
      },
      services: {
        title: '降低底蓋量產風險的整合服務',
        subtitle: '設計諮詢、表面處理控管與履約方案，全程貼合您的外殼藍圖。',
        card1Title: '設計與 DFM 協作',
        card1Text: '工程團隊優化螺柱、肋骨、散熱孔與定位點，在開模前就符合機構與外觀目標。',
        card1Cta: '查看工程服務',
        card2Title: '表面處理與驗證實驗室',
        card2Text: '內建噴塗、電鍍、紋理與耐久測試，確保每件底蓋通過耐磨、耐化與摔落要求。',
        card2Cta: '瀏覽表面處理選項',
        card3Title: '全球履約方案',
        card3Text: '套件化、標籤作業與區域緩衝庫存，與您的代工夥伴整合達成 JIT 組裝。',
        card3Cta: '規劃量產時程'
      },
      testimonial: {
        quote1: 'Toptec 在三週內重整我們底蓋的模具與表面處理，外觀報廢率下降，電動滑板車量產如期進行。',
        cite1: '營運總監｜AN XIN Mobility',
        quote2: '他們團隊掌握多色底蓋與出口包裝，智慧家居主機沒有一次延遲出貨。',
        cite2: '硬體主管｜COCOCLOUD'
      },
      cta: {
        title: '準備推出完美底蓋嗎？',
        subtitle: '聯繫專家取得涵蓋模具、表面處理與履約的量產計畫。',
        button: '預約製造諮詢'
      }
    },
    footer: {
      brand: 'TOPTEC GLOBAL',
      tagline: 'Top Technology, Global Reach — 以無懈可擊的品質與可靠性交付關鍵零件。',
      linksTitle: '公司資訊',
      about: '關於我們',
      services: '產品與服務',
      solutions: '解決方案',
      cases: '成功案例',
      contact: '聯絡我們',
      resourcesTitle: '資源中心',
      resource1: '供應商資格流程',
      resource2: '永續承諾',
      resource3: '合規與認證',
      resource4: '新聞與洞察',
      newsletterTitle: '掌握最新消息',
      newsletterText: '訂閱產業情報與底蓋製造動態。',
      newsletterLabel: '電子郵件',
      newsletterPlaceholder: '請輸入公司電子郵件',
      newsletterCta: '訂閱',
      copy: '© 2024 TOPTEC GLOBAL PTE. LTD. 版權所有。',
      privacy: '隱私權政策',
      terms: '使用條款'
    },
    contact: {
      hero: {
        eyebrow: '一起合作',
        title: '與 TOPTEC Global 聯繫',
        subtitle:
          '告訴我們您的底蓋或履約挑戰，我們的團隊會快速提供支援。'
      },
      form: {
        title: '傳送您的需求',
        subtitle: '留下聯絡資料與專案概述，我們會在一個工作天內回覆。',
        nameLabel: '姓名',
        namePlaceholder: '請輸入姓名',
        companyLabel: '公司',
        companyPlaceholder: '請輸入公司名稱',
        titleLabel: '職稱',
        titlePlaceholder: '例：採購經理',
        emailLabel: '公司信箱',
        emailPlaceholder: 'name@company.com',
        phoneLabel: '電話（選填）',
        phonePlaceholder: '國碼 + 號碼',
        messageLabel: '我們可以如何協助？',
        messagePlaceholder: '請描述需求或時程',
        successMessage: '感謝您的來信，我們會在一個工作天內與您聯繫。',
        submit: '送出詢問',
        assurance: '提交料號或圖面，我們會於 24 小時內回覆採購方案（週一至週五，GMT+8）。',
        privacyLabel: '我已閱讀並同意 <a href="privacy.html">隱私權政策</a>。'
      },
      details: {
        title: '直接聯繫方式',
        text: '週一至週五（GMT+8）09:00-18:00，專家在線待命。',
        phoneLabel: '電話：',
        phoneValue: '+65 6970 3201',
        emailLabel: 'Email：',
        emailValue: 'hello@toptecglobal.com',
        addressLabel: '地址：',
        addressValue: '8 Marina View, #35-02 Asia Square Tower 1, Singapore 018960',
        response: '我們力求在一個工作天內回覆所有詢問。'
      },
      map: {
        title: '歡迎預約拜訪總部'
      },
      resources: {
        title: '需要立即解答？',
        text: '瀏覽常見問題或使用即時對話，取得零件可用性與物流支援。',
        cta: '查看產業方案'
      },
      cta: {
        title: '我們隨時支援您的下一個專案',
        subtitle: '無論緊急採購或長期合作，現在就與我們聯繫。',
        button: '立即致電',
        commit: '提交料號或圖面，我們會於 24 小時內回覆（週一至週五，GMT+8）。'
      }
    },
    solutions": {
      hero: {
        eyebrow: '底蓋專業',
        title: '為各類裝置打造專屬方案',
        subtitle:
          '我們為消費、行動與工業市場的底蓋整合設計、模具、表面處理與物流履約。',
        ctaPrimary: '瀏覽應用攻略',
        ctaSecondary: '與製造團隊洽談'
      },
      industries: {
        title: '應用攻略',
        subtitle: '每個方案都對應獨特的外觀、結構與物流需求，讓底蓋到廠即可組裝。',
        card1Title: '智慧居家與 IoT',
        card1Pain: '痛點：大量出貨下仍需頻繁改款與精確的外觀公差。',
        card1Solution: '解方：多腔模具搭配快速更換嵌件、線上配色實驗室與 100% 外觀檢驗。',
        card1Result: '成果：維持 Delta E <1 的色差，同時每月出貨 30 萬件底蓋。',
        card2Title: '個人移動裝置',
        card2Pain: '痛點：高載重戶外使用需要兼顧結構強度與耐候性。',
        card2Solution: '解方：鋁材與強化聚合物底蓋，通過疲勞、鹽霧與衝擊測試驗證。',
        card2Result: '成果：使用壽命提升 25%，並一次通過法規摔落測試。',
        card3Title: '醫療與健康設備',
        card3Pain: '痛點：病患接觸設備需要生物相容表面與無塵包裝。',
        card3Solution: '解方：醫療級塗層、UV 消毒流程與 ISO 13485 文件套件。',
        card3Result: '成果：加速法規審查並達成零汙染偏差。',
        card4Title: '工控與自動化',
        card4Pain: '痛點：低至中量客製底蓋伴隨複雜組裝需求。',
        card4Solution: '解方：彈性 CNC 與成型混線、模組化治具與套件化扣件，實現即插即用。',
        card4Result: '成果：組裝時間縮短 32%，廠內返工率降至 1% 以下。',
        card5Title: '高階消費電子',
        card5Pain: '痛點：旗艦產品需頂級質感與完美貼合。',
        card5Solution: '解方：玻璃珠噴砂、PVD 與自動拋光，搭配外觀 SPC 儀表板。',
        card5Result: '成果：為五大區上市提供零刮傷底蓋。',
        card6Title: '商用設備與零售科技',
        card6Pain: '痛點：高流量場域需要耐用且易維修的底蓋。',
        card6Solution: '解方：粉體塗裝金屬底座與快速拆換面板，搭配具 IP 等級的密封與防拆螺件。',
        card6Result: '成果：維修時間縮短 40%，部署 12 個月後仍維持外觀規格。'
      },
      methodology: {
        title: '方案方法論',
        point1: '與您的工程團隊協作機構規格、紋理與組裝介面。',
        point2: '透過軟模與表面處理試作快速驗證手感與性能。',
        point3: '以類 PPAP 驗證與數位儀表板監控良率、外觀 SPC 與物流，順利擴產。'
      },
      value: {
        title: '為您帶來的價值',
        point1: '嚴謹製程控管與測試確保 Class-A 外觀一致性。',
        point2: '模具、表面與包裝同步到位，加速量產爬坡。',
        point3: '透過區域履約與減廢設計降低總到岸成本。'
      },
      faq: {
        title: '常見問題',
        subtitle: '回覆機構、機構工程及 NPI 團隊在合作時最常提的問題。',
        q1: '你們能支援哪些底蓋材料與製程？',
        a1: '我們可處理鋁、鎂、不鏽鋼、ABS/PC 複材與強化塑料，並提供噴塗、水轉印、陽極處理到 PVD 等表面處理。',
        q2: '多久可以提供量產樣品？',
        a2: '軟模樣品 10–15 個工作天交付，多腔量產 T1 樣品視複雜度約 25 天。',
        q3: '是否能代管組裝與包裝需求？',
        a3: '可以。我們可預裝嵌件、EMI 膠條、止滑腳墊，並提供客製包材、標籤與套件，直接對接代工產線。',
        q4: '如何確保大量出貨時的外觀一致？',
        a4: '透過母板管理、線上視覺檢測與 SPC 報告，再搭配與您品質團隊協作的改善機制。'
      },
      cta: {
        title: '與我們一起實現下一個底蓋專案',
        subtitle: '提供機構圖或樣品，我們將規劃模具、表面與履約方案。',
        button: '啟動專案'
      }
    },
    cases: {
      hero: {
        eyebrow: '底蓋成功案例',
        title: '精密底蓋製造成就真實上市',
        subtitle:
          '看看我們如何與品牌協作，兼顧外觀、結構與物流成果。',
        ctaPrimary: '查看底蓋案例',
        ctaSecondary: '討論您的專案'
      },
      list: {
        title: '精選底蓋專案',
        subtitle: '每個案例都展示我們如何將底蓋設計從概念推進到量產。'
      },
      case1: {
        title: '降低個人移動底蓋外觀報廢',
        industry: '產業：個人移動裝置',
        region: '地區：東南亞',
        challenge: '挑戰：「我們電動滑板車的底蓋在光澤與衝擊檢測上不合格，量產一再延誤。」',
        solution: '解方：調整模具排氣、導入機械化打磨並於各色系加入線上光澤量測。',
        result: '成果：外觀報廢率下降 42%，量產提前兩週達到滿產。',
        client: '客戶：AN XIN'
      },
      case2: {
        title: '八週內推出多色智慧家庭主機底蓋',
        industry: '產業：智慧居家與 IoT',
        region: '地區：東亞',
        challenge: '挑戰：「我們缺乏人力製作全球上市所需的多色底蓋且須保持一致質感。」',
        solution: '解方：快速提供 DFM、製作多腔鋼模，並建立搭配線上分光儀的噴塗配方。',
        result: '成果：量產 30 萬件底蓋，Delta E < 1，準時完成上市出貨。',
        client: '客戶：COCOCLOUD'
      },
      case3: {
        title: '工控主機模組化組裝不再延誤',
        industry: '產業：工控與自動化',
        region: '地區：歐洲',
        challenge: '挑戰：「裝配團隊面臨定位點誤差與零件包不一致，持續拖慢進度。」',
        solution: '解方：改採 CNC 與成型混線、預埋螺牙並提供線別套件化扣件。',
        result: '成果：組裝時間縮短 32%，廠內返工率降至 1% 以下。',
        client: '客戶：WINTEAM'
      },
      case4: {
        title: '打造美妝裝置底蓋的鏡面光澤',
        industry: '產業：美妝與健康',
        region: '地區：北美',
        challenge: '挑戰：「必須達到無旋紋的鏡面光澤，同時符合零售包裝的外觀檢查。」',
        solution: '解方：結合 PVD 基底、UV 透明塗層與無塵包裝，加上單件防護膜。',
        result: '成果：上市後零外觀退貨，支援 12 萬件的上市量產。',
        client: '客戶：Style Up'
      },
      cta: {
        title: '規劃您的底蓋成功案例',
        subtitle: '提供圖面、表面處理與時程，我們將擬定製造路線圖。',
        button: '安排諮詢'
      }
    },
    general: {
      newsletterSuccess: '感謝訂閱，我們將持續提供最新訊息。',
      form: {
        required: '請填寫此欄位。',
        email: '請輸入有效的電子郵件。',
        submitting: '送出中…',
        success: '訊息已送出，我們將儘快與您聯繫。'
      }
    }
  }};

document.addEventListener('DOMContentLoaded', () => {
  const body = document.body;
  const nav = document.querySelector('nav.primary-nav');
  const toggle = document.querySelector('.mobile-toggle');
  const langButtons = document.querySelectorAll('.language-switcher button[data-lang]');
  const htmlElement = document.documentElement;
  const currentPage = body.dataset.page;\r\n\r\n  let formMessages = {};\r\n  function updateFormMessages(lang) {\r\n    const target = lang || body.dataset.lang || 'en';\r\n    formMessages = {\r\n      required: getTranslation(target, 'general.form.required') || 'Please fill out this field.',\r\n      email: getTranslation(target, 'general.form.email') || 'Please enter a valid email address.',\n      businessEmail: getTranslation(target, 'general.form.businessEmail') || 'Please use your business email address.',\n      privacy: getTranslation(target, 'general.form.privacy') || 'Please agree to the Privacy Policy before submitting.',\r\n      submitting: getTranslation(target, 'general.form.submitting') || 'Submitting...',\r\n      success: getTranslation(target, 'general.form.success') || 'Your message has been sent. We will respond shortly.'\r\n    };\r\n  }\r\n\r\n  updateFormMessages(body.dataset.lang || 'en');\r\n\r\n  const navLinks = nav ? nav.querySelectorAll('a[data-page]') : [];
  navLinks.forEach((link) => {
    if (link.dataset.page === currentPage) {
      link.classList.add('active');
    }
  });

  if (toggle && nav) {
    toggle.addEventListener('click', () => {
      const expanded = toggle.getAttribute('aria-expanded') === 'true';
      toggle.setAttribute('aria-expanded', String(!expanded));
      nav.classList.toggle('open');
    });

    navLinks.forEach((link) => {
      link.addEventListener('click', () => {
        nav.classList.remove('open');
        toggle.setAttribute('aria-expanded', 'false');
      });
    });
  }

  const i18nElements = document.querySelectorAll('[data-i18n]');
  const placeholderElements = document.querySelectorAll('[data-i18n-placeholder]');

  i18nElements.forEach((el) => {
    if (!el.dataset.i18nEn) {
      el.dataset.i18nEn = el.innerHTML.trim();
    }
  });

  placeholderElements.forEach((el) => {
    if (!el.dataset.i18nPlaceholderEn) {
      el.dataset.i18nPlaceholderEn = el.getAttribute('placeholder') || '';
    }
  });

  function getTranslation(lang, key) {
    const parts = key.split('.');
    let value = translations[lang];
    for (const part of parts) {
      if (!value) {
        return undefined;
      }
      value = value[part];
    }
    return typeof value === 'string' ? value : undefined;
  }

  function setLanguage(lang) {
    const targetLang = lang === 'zh-Hant' ? 'zh-Hant' : 'en';
    htmlElement.setAttribute('lang', targetLang === 'zh-Hant' ? 'zh-Hant' : 'en');
    body.dataset.lang = targetLang;\r\n\r\n    updateFormMessages(targetLang);\r\n\r\n    langButtons.forEach((btn) => {
      btn.classList.toggle('active', btn.dataset.lang === targetLang);
    });

    i18nElements.forEach((el) => {
      const key = el.dataset.i18n;
      if (!key) return;
      if (targetLang === 'en') {
        el.innerHTML = el.dataset.i18nEn || el.innerHTML;
      } else {
        const translated = getTranslation(targetLang, key);
        el.innerHTML = translated || el.dataset.i18nEn || el.innerHTML;
      }
    });

    placeholderElements.forEach((el) => {
      const key = el.dataset.i18nPlaceholder;
      if (!key) return;
      if (targetLang === 'en') {
        el.setAttribute('placeholder', el.dataset.i18nPlaceholderEn || '');
      } else {
        const translated = getTranslation(targetLang, key);
        el.setAttribute('placeholder', translated || el.dataset.i18nPlaceholderEn || '');
      }
    });

    localStorage.setItem('toptec-lang', targetLang);
  }

  const savedLang = localStorage.getItem('toptec-lang') || 'en';
  setLanguage(savedLang);

  langButtons.forEach((btn) => {
    btn.addEventListener('click', () => {
      const lang = btn.dataset.lang || 'en';
      setLanguage(lang);
    });
  });

  const faqItems = document.querySelectorAll('.faq-item');
  faqItems.forEach((item) => {
    item.addEventListener('click', () => {
      item.classList.toggle('open');
    });
    item.addEventListener('keypress', (event) => {
      if (event.key === 'Enter' || event.key === ' ') {
        event.preventDefault();
        item.classList.toggle('open');
      }
    });
  });

  const testimonialSlides = document.querySelectorAll('.testimonial-slide');
  const prevBtn = document.querySelector('.testimonial-prev');
  const nextBtn = document.querySelector('.testimonial-next');
  let testimonialIndex = 0;

  function showTestimonial(index) {
    testimonialSlides.forEach((slide, idx) => {
      slide.classList.toggle('active', idx === index);
    });
  }

  if (testimonialSlides.length > 0) {
    showTestimonial(testimonialIndex);

    prevBtn?.addEventListener('click', () => {
      testimonialIndex = (testimonialIndex - 1 + testimonialSlides.length) % testimonialSlides.length;
      showTestimonial(testimonialIndex);
    });

    nextBtn?.addEventListener('click', () => {
      testimonialIndex = (testimonialIndex + 1) % testimonialSlides.length;
      showTestimonial(testimonialIndex);
    });

    setInterval(() => {
      testimonialIndex = (testimonialIndex + 1) % testimonialSlides.length;
      showTestimonial(testimonialIndex);
    }, 8000);
  }

  const contactForm = document.querySelector('#contact-form');
  if (contactForm) {
    const formFields = contactForm.querySelectorAll('input[required], textarea[required]');
    const submitButton = contactForm.querySelector("button[type='submit']");
    const emailField = contactForm.querySelector('#email');
    const privacyCheckbox = contactForm.querySelector('#agree-privacy');
    const freeEmailDomains = ['gmail.com', 'yahoo.com', 'hotmail.com', 'outlook.com', 'icloud.com', 'aol.com', 'qq.com', '163.com', '126.com', 'protonmail.com', 'hey.com', 'msn.com', 'live.com', 'me.com', 'gmx.com'];

    const isFreeDomain = (address) => {
      const atIndex = address.indexOf('@');
      if (atIndex === -1) return false;
      const domain = address.slice(atIndex + 1).toLowerCase();
      return freeEmailDomains.some((freeDomain) => domain === freeDomain || domain.endsWith('.' + freeDomain));
    };

    const validateBusinessEmail = () => {
      if (!emailField) return;
      const value = emailField.value.trim().toLowerCase();
      if (value && isFreeDomain(value)) {
        emailField.setCustomValidity(formMessages.businessEmail);
      } else {
        emailField.setCustomValidity('');
      }
    };

    if (emailField) {
      emailField.addEventListener('input', validateBusinessEmail);
      emailField.addEventListener('blur', validateBusinessEmail);
    }

    if (privacyCheckbox) {
      privacyCheckbox.addEventListener('change', () => {
        privacyCheckbox.setCustomValidity('');
      });
    }

    formFields.forEach((field) => {
      field.addEventListener('input', () => {
        field.setCustomValidity('');
      });

      field.addEventListener('invalid', () => {
        if (field.validity.customError) return;
        let message = formMessages.required;
        if (field.type === 'email') {
          message = formMessages.email;
        } else if (privacyCheckbox && field === privacyCheckbox) {
          message = formMessages.privacy;
        }
        field.setCustomValidity(message);
      });
    });

    contactForm.addEventListener('submit', (event) => {
      validateBusinessEmail();
      if (privacyCheckbox) {
        if (!privacyCheckbox.checked) {
          privacyCheckbox.setCustomValidity(formMessages.privacy);
        } else {
          privacyCheckbox.setCustomValidity('');
        }
      }

      if (!contactForm.checkValidity()) {
        event.preventDefault();
        contactForm.reportValidity();
        return;
      }

      event.preventDefault();
      if (submitButton) {
        submitButton.dataset.originalLabel = submitButton.textContent;
        submitButton.disabled = true;
        submitButton.textContent = formMessages.submitting;
      }

      const successMessage = contactForm.querySelector('.success-message');
      contactForm.reset();
      formFields.forEach((field) => field.setCustomValidity(''));

      if (successMessage) {
        successMessage.textContent = formMessages.success;
        successMessage.classList.add('show');
        setTimeout(() => successMessage.classList.remove('show'), 6000);
      }

      if (submitButton) {
        const resetText = submitButton.dataset.originalLabel || submitButton.textContent;
        setTimeout(() => {
          submitButton.disabled = false;
          submitButton.textContent = resetText;
        }, 600);
      }
    });
  }
  const newsletterForms = document.querySelectorAll('.newsletter-form');
  newsletterForms.forEach((form) => {
    form.addEventListener('submit', (event) => {
      event.preventDefault();
      form.reset();
      const lang = body.dataset.lang || 'en';
      const message =
        lang === 'zh-Hant'
          ? getTranslation('zh-Hant', 'general.newsletterSuccess') || '感謝訂閱，我們將持續提供最新訊息。'
          : 'Thank you for subscribing. Stay tuned for our updates.';
      window.alert(message);
    });
  });
});
